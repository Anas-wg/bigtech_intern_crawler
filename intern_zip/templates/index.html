<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¹…í…Œí¬ ì±„ìš© ê³µê³  ë¦¬ìŠ¤íŠ¸</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Fontawesome -->
    <script
      src="https://kit.fontawesome.com/0c69fdf2c0.js"
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />

    <script defer>
      const companies = ["Naver", "Kakao", "LINE", "Woowa", "Daangn", "Toss"];

      // ğŸ“Š íšŒì‚¬ë³„ ê³µê³  ê°œìˆ˜ ê°€ì ¸ì˜¤ê¸°
      async function fetchJobCounts() {
        const response = await fetch("/api/jobs/count");
        const counts = await response.json();

        const countList = document.getElementById("count-list");
        countList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

        companies.forEach((company) => {
          const count = counts[company] || 0;
          const badgeClass = count === 0 ? "bg-danger" : "bg-primary"; // 0ê°œë©´ ë¹¨ê°„ìƒ‰, ì•„ë‹ˆë©´ íŒŒë€ìƒ‰

          const listItem = document.createElement("li");
          listItem.classList.add(
            "list-group-item",
            "d-flex",
            "justify-content-between",
            "align-items-center"
          );
          listItem.innerHTML = `<strong>${company}</strong> <span class="badge ${badgeClass} rounded-pill">${count}ê°œ</span>`;
          countList.appendChild(listItem);
        });
      }

      // â³ ë§ˆì§€ë§‰ í¬ë¡¤ë§ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
      async function fetchLastCrawlTime() {
        const response = await fetch("/api/last-crawl");
        const data = await response.json();
        document.getElementById("last-crawl-time").textContent =
          data.last_crawl || "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      }

      // ğŸ” ì±„ìš© ê³µê³  ê°€ì ¸ì˜¤ê¸°
      async function fetchJobs() {
        const company = document.getElementById("company").value;
        const url = company === "all" ? "/api/jobs" : `/api/jobs/${company}`;

        const response = await fetch(url);
        const jobs = await response.json();

        const jobList = document.getElementById("job-list");
        jobList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

        if (jobs.length === 0) {
          jobList.innerHTML = `<li class="list-group-item text-danger">âš ï¸ í•´ë‹¹ íšŒì‚¬ì˜ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</li>`;
          return;
        }

        jobs.forEach((job) => {
          const listItem = document.createElement("li");
          listItem.classList.add("list-group-item");
          listItem.innerHTML = `<a href="${job.notice_url}" target="_blank" class="text-decoration-none">${job.title} (${job.company})</a> - <span class="text-muted">${job.period}</span>`;
          jobList.appendChild(listItem);
        });
      }

      // âœ… ì´ˆê¸° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
      fetchJobCounts();
      fetchLastCrawlTime();
    </script>
  </head>
  <body class="bg-light">
    <div class="container py-4">
      <h1 class="text-center mb-4">ğŸ“¢ ë¹…í…Œí¬ ê°œë°œì ì¸í„´ ì±„ìš© ê³µê³  ë¦¬ìŠ¤íŠ¸</h1>

      <div class="callout callout-warning">
        <h5><i class="fa-solid fa-note-sticky"></i> Notice</h5>
        <p>ë§¤ì¼ ì˜¤ì „ 8ì‹œì— ê³µê³ ë¥¼ í¬ë¡¤ë§í•´ì˜µë‹ˆë‹¤.</p>
      </div>

      <!-- ğŸ”¹ íšŒì‚¬ë³„ ê³µê³  ê°œìˆ˜ (ì¹´ë“œ ìŠ¤íƒ€ì¼ ì ìš©) -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title">ğŸ“Š í˜„ì¬ ê³µê³  ê°œìˆ˜</h5>
          <ul id="count-list" class="list-group list-group-flush">
            <li class="list-group-item">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
          </ul>
        </div>
      </div>

      <!-- ğŸ”¹ ë§ˆì§€ë§‰ í¬ë¡¤ë§ ì‹œê°„ í‘œì‹œ -->
      <div class="text-center mb-4">
        <h6>
          ğŸ“… ë§ˆì§€ë§‰ í¬ë¡¤ë§ ì‹œê°„:
          <span id="last-crawl-time">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
        </h6>
      </div>

      <!-- ğŸ”¹ ê²€ìƒ‰ ì˜ì—­ -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title text-center">ğŸ” ì±„ìš© ê³µê³  ê²€ìƒ‰</h5>
          <div class="flex-column align-items-center">
            <div class="mb-3 w-100">
              <select id="company" class="form-select">
                <option value="all">ì „ì²´</option>
                <option value="Naver">Naver</option>
                <option value="Kakao">Kakao</option>
                <option value="LINE">LINE</option>
                <option value="Woowa">ë°°ë‹¬ì˜ë¯¼ì¡±(ìš°ì•„í•œí˜•ì œë“¤)</option>
                <option value="Daangn">Daangn</option>
                <option value="Toss">Toss</option>
              </select>
            </div>
            <div class="w-100">
              <button class="btn btn-primary w-100" onclick="fetchJobs()">
                ğŸ” ê²€ìƒ‰
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ğŸ”¹ ê³µê³  ë¦¬ìŠ¤íŠ¸ -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">ğŸ“‹ ê³µê³  ë¦¬ìŠ¤íŠ¸</h5>
          <ul id="job-list" class="list-group"></ul>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
